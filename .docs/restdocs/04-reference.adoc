= 참고 자료
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 3
:sectnums:

== Best Practices

=== 1. 테스트 메서드 네이밍

명확한 영문 snake_case 네이밍으로 생성되는 스니펫 디렉토리 이름이 의미 있도록 합니다.

[source,kotlin]
----
// Good: 생성되는 스니펫 디렉토리 = get-holidays-by-year
@Test
fun `get holidays by year`(): Unit { }

// Bad: 생성되는 스니펫 디렉토리 = should-return-holidays
@Test
fun `should return holidays`(): Unit { }
----

=== 2. 필드 설명은 한글로 작성

[source,kotlin]
----
// Good: 명확한 한글 설명
"data.name" type STRING means "공휴일 이름"
"data.date" type DATE means "공휴일 날짜"

// Avoid: 영문 또는 불명확한 설명
"data.name" type STRING means "holiday name"
"data.date" type DATE means "date"
----

=== 3. 복잡한 응답은 Subsection 전략 사용

[source,kotlin]
----
// 배열 응답이나 필드가 많은 경우
responseFields(*responseCommonFieldsSubsection()),
dataResponseFields(
    "field1" type STRING means "설명",
    "field2" type NUMBER means "설명",
)

// 단순한 응답만 전체 필드 한 곳에 정의
responseFields(
    *responseCommonFields(),
    *fields(...)
)
----

=== 4. 샘플 값과 기본값 활용

[source,kotlin]
----
// example과 withDefaultValue 구분
"data.status" type STRING means "상태"
    example "ACTIVE"
    withDefaultValue "PENDING"

// isOptional로 선택 필드 표시
"data.description" type STRING means "설명" isOptional true
----

=== 5. 열거형 타입 활용

[source,kotlin]
----
// ENUM 타입으로 자동 포맷 적용
"data.status" type ENUM(OrderStatus::class) means "주문 상태"
// 출력: `PENDING` / `PROCESSING` / `COMPLETED` / `CANCELLED`

// 특정 값만
"data.priority" type ENUM(listOf(Priority.HIGH, Priority.MEDIUM)) means "우선순위"
----

=== 6. 날짜/시간 타입 자동 포맷

[source,kotlin]
----
// DATE 타입 - 자동으로 yyyy-MM-dd 포맷
"data.birthday" type DATE means "생년월일"

// DATETIME 타입 - 자동으로 yyyy-MM-dd'T'HH:mm:ss 포맷
"data.createdAt" type DATETIME means "생성 일시"

// 커스텀 포맷이 필요한 경우
"data.timestamp" type NUMBER means "타임스탬프" example "1738473600000"
----

=== 7. 배열 필드명 명확하게

[source,kotlin]
----
// Good: 복수형으로 명확하게
"data.holidays" type ARRAY means "공휴일 목록"
"data.holidays[].name" type STRING means "공휴일 이름"

// Less clear: 단수형
"data.holiday" type ARRAY means "공휴일 목록"
----

=== 8. 모킹된 데이터와 스니펫의 일관성

테스트에서 사용하는 모의 데이터가 실제 응답과 일치하도록 합니다.

[source,kotlin]
----
// given - 모의 데이터
val holidayDto = HolidayDto(1L, LocalDate.of(2026, 1, 1), "신정")
given(holidayFacade.create(any())).willReturn(holidayDto)

// 문서화 - 모의 데이터와 일치
dataResponseFields(
    "id" type NUMBER means "공휴일 ID",
    "holidayDate" type DATE means "공휴일 날짜",  // LocalDate.of 사용했으므로 DATE
    "name" type STRING means "공휴일 이름",
)
----

=== 9. 테스트는 행복한 경로(Happy Path)만 문서화

[source,kotlin]
----
// Good: 성공 케이스만 문서화
@Test
fun `create holiday`(): Unit {
    val holidayDto = HolidayDto(1L, LocalDate.of(2026, 1, 1), "신정")
    given(holidayFacade.create(any())).willReturn(holidayDto)
    mockMvc.perform(post("/api/holidays")...)
}

// 에러 응답은 별도 문서나 설명으로 처리
----

=== 10. 필드 경로는 정확하게

[source,kotlin]
----
// responseCommonFields() 사용 시 - 전체 경로 명시
responseFields(
    *responseCommonFields(),
    *fields(
        "data.id" type NUMBER means "ID",        // "data." 접두사 필요
        "data.name" type STRING means "이름",
    )
)

// dataResponseFields() 사용 시 - "data." 접두사 제외
dataResponseFields(
    "id" type NUMBER means "ID",               // "data." 접두사 없음
    "name" type STRING means "이름",
)
----

=== 11. 공통 응답 필드는 수정하지 않기

[source,kotlin]
----
// Good: RestDocsSupport의 메서드 그대로 사용
responseFields(*responseCommonFieldsSubsection())

// Bad: 임의로 수정
responseFields(
    "status" type OBJECT means "커스텀 설명",  // 표준 필드 변경 금지
)
----

=== 12. 빌드 과정에서 스니펫 생성 확인

테스트 실행 후 스니펫이 정상 생성되는지 확인합니다.

[source,bash]
----
# 테스트 실행
./gradlew test

# 생성된 스니펫 확인
ls build/generated-snippets/

# 특정 테스트의 스니펫 확인
cat build/generated-snippets/create-holiday/response-fields.adoc
----

== 트러블슈팅

=== 문제: "No such file or directory" 에러

**원인**: 스니펫이 생성되지 않음 (테스트 실패)

**해결**:
1. 테스트 실행 확인: `./gradlew test --info`
2. 테스트 실패 여부 확인
3. 모킹 설정 검토

[source,bash]
----
# 특정 테스트만 실행
./gradlew test --tests "HolidayControllerDocsTest.get holidays by year"
----

=== 문제: 필드 타입이 DocumentFormat에 반영 안됨

**원인**: DocsFieldType 사용 안함

**해결**: 항상 infix `type` 함수와 DocsFieldType 사용

[source,kotlin]
----
// Bad: String 타입 직접 사용
"data.name".type(NUMBER) means "이름"

// Good: DocsFieldType 사용
"data.name" type STRING means "이름"
----

=== 문제: AsciiDoc 포함 실패

**원인**: 스니펫 경로가 잘못됨

**해결**: 실제 디렉토리 이름 확인

[source,bash]
----
# 정확한 스니펫 경로 확인
find build/generated-snippets -name "*.adoc"

# 테스트 메서드명이 스니펫 디렉토리명 결정
@Test
fun `create holiday`(): Unit  // → create-holiday 디렉토리
----

== 요약 체크리스트

DocsTest 작성 시 다음 항목을 확인하세요:

* [ ] `RestDocsSupport` 상속
* [ ] `initController()` 구현
* [ ] MockMvc 요청 수행
* [ ] 경로 파라미터 문서화 (필요시)
* [ ] 요청 필드 문서화 (필요시)
* [ ] 응답 필드 문서화
* [ ] 필드 타입에 `DocsFieldType` 사용
* [ ] 필드 설명은 한글로 작성
* [ ] `type`, `means` infix 함수 사용
* [ ] 선택적 필드는 `isOptional true` 추가
* [ ] 날짜는 `DATE`, 날짜시간은 `DATETIME` 사용
* [ ] 열거형은 `ENUM(Class::class)` 사용
* [ ] 테스트 메서드명은 명확한 영문 snake_case
* [ ] 모의 데이터와 문서화 필드 일치
* [ ] 테스트 실행 후 스니펫 생성 확인
* [ ] AsciiDoc 문서에 스니펫 포함

== 빌드 및 실행

=== HTML 문서 생성

[source,bash]
----
# 문서 생성 (테스트 실행 → 스니펫 복사 → HTML 생성)
./gradlew :modules:docs:docs

# 클린 빌드
./gradlew clean :modules:docs:docs
----

=== 테스트만 실행 (스니펫 생성)

[source,bash]
----
# 전체 테스트 실행
./gradlew test

# 특정 테스트만 실행
./gradlew :modules:bootstrap:skeleton-api-app:test --tests "com.myrealtrip.skeletonapiapp.api.TodoControllerDocsTest"

# 공통 응답 문서 스니펫만 생성
./gradlew :modules:bootstrap:skeleton-api-app:test --tests "com.myrealtrip.skeletonapiapp.docs.common.*"
----

=== 생성된 문서 위치

[source,text]
----
modules/docs/build/docs/
├── index.html                              # 문서 홈
└── common-api-app/
    └── holiday/
        ├── holiday-query-v1.html           # Holiday 조회 API
        └── holiday-command-v1.html         # Holiday CUD API
----

=== Task 의존성

[source,text]
----
:modules:bootstrap:common-api-app:test
:modules:bootstrap:skeleton-api-app:test
        ↓
  copySnippets (스니펫을 docs 모듈로 복사)
        ↓
  asciidoctor (AsciiDoc → HTML 변환)
        ↓
     docs
----

== API 문서 템플릿

새 API 문서 작성 시 `.templates/template-api-docs.adoc` 템플릿을 복사하여 사용합니다.

**템플릿 위치**: `modules/docs/src/docs/asciidoc/.templates/template-api-docs.adoc`

=== 템플릿 구조

[source,text]
----
= {API_NAME} API
= Overview
= APIs
  == 조회
    === 목록 조회
    === 상세 조회
  == 등록
    === 단건 등록
    === 대량 등록
  == 수정
    === 수정
  == 삭제
    === 삭제
----

=== 플레이스홀더

[cols="2,3,2", options="header"]
|===
| 플레이스홀더 | 설명 | 예시

| `{API_NAME}`
| API 이름
| Holiday, User, Order

| `{api_description}`
| API 설명
| 공휴일 목록을 조회합니다

| `{test-class-name}`
| DocsTest 클래스명 (kebab-case)
| holiday-controller-docs-test

| `{test-method-name}`
| 테스트 메서드명
| get holidays by year
|===

=== 사용 방법

1. `.templates/template-api-docs.adoc` 복사
2. `{app-name}/{domain}/{domain}-{type}-v1.adoc`으로 저장
3. 플레이스홀더를 실제 값으로 변경
4. 필요 없는 API 섹션 삭제
5. `./gradlew clean :modules:docs:build` 실행

== 참고 파일

[cols="2,4", options="header"]
|===
| 파일 | 위치

| `template-api-docs.adoc`
| `modules/docs/src/docs/asciidoc/.templates/template-api-docs.adoc`

| `RestDocsSupport`
| `modules/test-support/src/testFixtures/kotlin/com/myrealtrip/testsupport/restdocs/RestDocsSupport.kt`

| `Field`
| `modules/test-support/src/testFixtures/kotlin/com/myrealtrip/testsupport/restdocs/Field.kt`

| `DocsFieldType`
| `modules/test-support/src/testFixtures/kotlin/com/myrealtrip/testsupport/restdocs/DocsFieldType.kt`

| `HolidayControllerDocsTest`
| `modules/bootstrap/common-api-app/src/test/kotlin/com/myrealtrip/commonapiapp/docs/HolidayControllerDocsTest.kt`

| `CustomResponseFieldsSnippet`
| `modules/test-support/src/testFixtures/kotlin/com/myrealtrip/testsupport/restdocs/CustomResponseFieldsSnippet.kt`

| `RestDocsAttributes`
| `modules/test-support/src/testFixtures/kotlin/com/myrealtrip/testsupport/restdocs/Field.kt` (동일 파일)
|===

== 추가 자료

* xref:../architecture/07-api-response-format.adoc[API 응답 형식] - ApiResource 구조
* xref:../architecture/03-error-handling.adoc[에러 처리] - 예외 처리 전략
* link:../../modules/test-support/README.adoc[Test Support 모듈] - 추가 유틸
* link:../../modules/bootstrap/common-api-app[Common API App] - 실제 사용 예시

---

**최종 업데이트**: 2026-02-13
